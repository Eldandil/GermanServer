<!DOCTYPE html>
<html>
	<head>
	<title>ClipCult Experiences</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
		html { height: 100% }
		body { height: 100%; margin: 0; padding: 0 }
		#map-canvas { height: 100% }
    </style>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

	<script>
	
	function initialize() {
        var latitude = 50.573087,
            longitude = 7.254032,
            center = new google.maps.LatLng(latitude,longitude),
            mapOptions = {
                center: center,
                zoom: 9,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        setMarkers(center, map);
    }

    function setMarkers(center, map) {
        var json = (function () { 
            var json = null; 
            $.ajax({ 
                'async': false, 
                'global': false, 
                'url': "http://localhost:5000/clipcultexperiences/api/v1.0/experiences", 
                'dataType': "json", 
                'success': function (data) {
                     json = data['experiences']; 
                 }
            });
            return json;
        })();


        //loop between each of the json elements
        for (var i = 0, length = json.length; i < length; i++) {
            var data = json[i],
            latLng = new google.maps.LatLng(data.lat, data.lng); 

            // Creating a marker and putting it on the map
            var marker = new google.maps.Marker({
				position: latLng,
                map: map,
                title: data.title
                });
                infoBox(map, marker, data);

        }

    }

    function infoBox(map, marker, data) {
        var infoWindow = new google.maps.InfoWindow();
        // Attaching a click event to the current marker
        google.maps.event.addListener(marker, "click", function(e) {
            infoWindow.setContent(data.title);
            infoWindow.open(map, marker);
        });

        // Creating a closure to retain the correct data 
        // Note how I pass the current data in the loop into the closure (marker, data)
        (function(marker, data) {
          // Attaching a click event to the current marker
          google.maps.event.addListener(marker, "click", function(e) {
            infoWindow.setContent(data.title);
            infoWindow.open(map, marker);
          });
        })(marker, data);
    }

   google.maps.event.addDomListener(window, 'load', initialize);
	
	
	</script>
	</head>
	<body>
		<div id="map-canvas"/>
	</body>
</html>
